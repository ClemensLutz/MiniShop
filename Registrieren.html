<!DOCTYPE html>
<html>
    <head>

<style>
  .col-sm-5 {
  color:maroon;
  font-weight: bold;
}
</style>


        <title>MiniShop</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    </head>
    <body>
      <div class="bg-secondary">
      <div class="bg-secondary">
        <div class="header bg-secondary">
                <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
                <div class="container-fluid ">
                  <a class="navbar-brand" href="./MiniShop.php"> <img style="width:110px;" src="../images/shopheader.jpg"> </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
          <span class="navbar-toggler-icon"></span>
        </button>
                <div class="collapse navbar-collapse " id="collapsibleNavbar">
                      <ul class="navbar-nav">
                        <li class="nav-item">
                          <a class="nav-link me-5 ms-3" href="./Anmelden.php"><h2>Sie haben bereits einen Account? -> Anmelden</h2></a>
                        </li>
                        
                    </ul>
                </div>
                </div>
                </nav>
              </div> 

<div class="container-fluid">
        <div class="row">

          <div class="col-sm-6 py-5 ps-5 pe-5 bg-secondary text-black text-center ">
            <br><br><br>
            <div class="col-sm-12 ps-5 pe-5 bg-secondary text-black text-center"><h2>Registrieren Sie sich bei uns!</h2></div>
            <br><br>
            <form id="signup"  method="post" action="insert.php">
              
              
            <div class="ms-5 ps-3 mb-3 mt-3 row">
                <label class="col-sm-3" for="username">Username:</label>
                <input class="col-sm-4" type="text" name="benutzername" id="username" autocomplete="off">
                <small class="col-sm-5"></small>
            </div>

            <div class="ms-5 ps-3 mb-3 mt-3 row">
                <label class="col-sm-3" for="email">Email:</label>
                <input class="col-sm-4" type="text" name="email" id="email" autocomplete="off">
                <small class="col-sm-5  "></small>
            </div>

            <div class="ms-5 ps-3 mb-3 mt-3 row">
                <label class="col-sm-3" for="password">Password:</label>
                <input class="col-sm-4" type="password" name="passwort" id="password" autocomplete="off">
                <small class="col-sm-5 "></small>
            </div>

            <div class="ms-5 ps-3 mb-3 mt-3 row">
              <label class="col-sm-3" for="confirm-password">Confirm Password:</label>
              <input class="col-sm-4" type="password" name="confirm-password" id="confirm-password" autocomplete="off">
              <small class="col-sm-5 "></small>
          </div>

            
          <div class="ms-5 ps-5 mb-3 mt-3 row p-3">
            <input class="col-sm-3 " type="submit" class="btn btn-primary " value="Registrieren">
        </div>
          </form>
          
          </div>  
          
              <div class="col-sm-6 py-5 ps-5 pe-5 mt-5 bg-secondary text-black text-center "><img src="../images/shoptitelseite.jpg" height="400" width="450"></div>
            </div>
            </div>
        </div>
        </div>
      </div>

      <script>

        // Zugriff auf Eingabeelemente
        // Die Funktion "querySelector" erlaubt es uns Elmente mit CCS Selektoren zu finden    
        const usernameEl = document.querySelector('#username');
        const emailEl = document.querySelector('#email');
        const passwordEl = document.querySelector('#password');
        const confirmPasswordEl = document.querySelector('#confirm-password');
        
        const form = document.querySelector('#signup');
        
        
        
        // Eine Funktion zum Anzeigen einer Fehlermeldung
        // input   ... das Eingabeelement
        // message ... die Fehlermeldung
        function showError (input, message) {
            // Ändern der Klassen des Elementes (class="...")
            input.classList.add('border');
            input.classList.add('border-danger');
            input.classList.add('border-2');
        
            // Wir gehen zum übergeordneten Element
            const formField = input.parentElement;
            // und suchen innerhalb (!!!) des Elementes nach einem Element <small>
            const errorField = formField.querySelector('small');
            // in diesem Element fügen wir einen Text ein
            errorField.textContent = message;
        };
        // sus
        
        function showSuccess (input) {
        
            input.classList.remove('border');
            input.classList.remove('border-danger');
            
            const formField = input.parentElement;
            const errorField = formField.querySelector('small');
            errorField.textContent = '';
        }
        
        
        
        
        // Hilfsfunktionen zum Überprüfen von Zeichenketten
        function isEmailValid(email) {
            const re = new RegExp("[a-zA-Z0-9\.]+@[a-zA-Z0-9\.]+");
            return re.test(email);
        }
        
        function isPasswordSecure(password) {
            const re = new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^&\*])(?=.{8,})");
            return re.test(password);
        }
        
        /*****************************************************************************************
         *    REGEX -  Reguläre Ausdrücke  - Schwindelzettel: 
         *****************************************************************************************
        Basics
        *       Match preceding character 0 or more times
        +       Match preceding character 1 or more times
        .       Match any single character
        x|y     Match either 'x' or 'y'
        \       Escape a special character
        b       The character b
        abc     The string abc
        
        Character Classes I
        \d      Match a digit character
        \D      Match a non-digit character
        \s      Match a single white space character (space, tab, form feed, or line feed)
        \S      Match a single character other than white space
        \w      Match any alphanumeric character (including underscore)
        \W      Match any non-word character
        
        Character Classes II
        [abc]   Match any one of the characters in the set 'abc'
        [^abc]  Match anything not in character set 'abc'
        [\b]    Match a backspace
        
        Assertions
        ^   Match beginning of input
        $   Match end of input
        \b  Match a word boundary
        \B  Match a non-word boundary
        ?=  Lookahead
        ?!  Negative lookahead
        
        Assertions II
        ?<=     Lookbehind
        ?<!     Negative lookbehind
        ?>      Once-only subexpression
        ?()     If then condition
        ?()|    If then else condition
        ?#      Comment
        
        Quantifiers
        {n}     Match exactly n occurrences of preceding character
        {n,m}   Match at least n and at most m occurrences of the preceding character
        ?       Match 0 or 1
        
        Special Characters I
        \cX     Match control character X in a string
        \n      Match a line feed
        \r      Match a carriage return
        \t      Match a tab
        \0      Match a NULL
        \f      Match a form feed
        \v      Match a vertical tab
        \xhh    Match character with code hh (2 hex digits)
        \uhhhh  Match character with code hhhh (4 hex digits)
        
        Flags
        g       Global search
        i       Case-insensitive search
        m       Multi-line search
        y       "sticky" search match starting at current position in target string
        
        Groups
        (x)     Match 'x' and remember the match
        (?:x)   Match 'x' but do not remember the match
        \n      A back reference to the last substring matching the n parenthetical in the regex
        *****************************************************************************************/
        
        function isRequired(value) {
            return value === '' ? false : true; 
        }
        
        function isBetween(length, min, max) {
            return length < min || length > max ? false : true;
        }
        
        
        // Die Logik für ein Feld:
        function checkUsername() {
  let valid = false;
  const min = 3, max = 25;
  // Wir lesen aus dem Element den Wert aus
  const username = usernameEl.value.trim();

  if (!isRequired(username)) {
    showError(usernameEl, "Username muss angegeben werden.");
  } else if (!isBetween(username.length, min, max)) {
    showError(usernameEl, "<strong>Username muss zwischen ${min} und ${max} Zeichen enthalten.</strong>");
  } else {
    showSuccess(usernameEl);
    valid = true;
  }
  return valid;
};
        
        
        function checkEmail() {
            let valid = false;
            const email = emailEl.value.trim();
            if (!isRequired(email)) {
                showError(emailEl, 'Email muss angegeben werden.');
            } else if (!isEmailValid(email)) {
                showError(emailEl, 'Email ist nicht gültig.')
            } else {
                showSuccess(emailEl);
                valid = true;
            }
            return valid;
        };
        
        function checkPassword() {
            let valid = false;
            const password = passwordEl.value.trim();
            if (!isRequired(password)) {
                showError(passwordEl, "Password muss angegeben werde");
            } else if (!isPasswordSecure(password)) {
                showError(passwordEl, "Password: mind. 8 Zeichen, mind 1 Kleinbuchstabe, 1 Großbuchstabe, 1 Zahl, and 1 Zeichen aus (!@#$%^&*)");
            } else {
                showSuccess(passwordEl);
                valid = true;
            }
            return valid;
        };
        
        function checkConfirmPassword() {
            let valid = false;
            // check confirm password
            const confirmPassword = confirmPasswordEl.value.trim();
            const password = passwordEl.value.trim();
            if (!isRequired(confirmPassword)) {
                showError(confirmPasswordEl, 'Password erneut eingeben');
            } else if (password !== confirmPassword) {
                showError(confirmPasswordEl, 'Die Passwörter stimmen nicht überein');
            } else {
                showSuccess(confirmPasswordEl);
                valid = true;
            }
            return valid;
        };
        
        // Überprüfung beim Absenden
        // =========================
        // Hinzufügen einer Behandlungsroutine für Ereignisse mittels "addEventListener"
        // erster Parameter: html Event (OHNE "on" !!!): onclick => click
        // zweiter Parameter:  die Funktion die das Ereignis verarbeitet
        form.addEventListener('submit', function (e) {
            // Felder überprüfen
            let isUsernameValid = checkUsername(),
                isEmailValid = checkEmail(),
                isPasswordValid = checkPassword(),
                isConfirmPasswordValid = checkConfirmPassword();
        
            let isFormValid = isUsernameValid &&
                              isEmailValid &&
                              isPasswordValid &&
                              isConfirmPasswordValid;
        
            if (! isFormValid) {
                // Bei Fehler werden die Fromulardaten nicht gesendet 
                e.preventDefault();
            }
        });
        
        
        
        // Überprüfung beim Ausfüllen der Eingabefelder
        // =============================================
        // Eine Funktion  verzögert ausführen
        // Kopieren und wieder verwenden !
        // fn    ... die Funktion
        // delay ... die Verzögerung
        
        function executeFunctionAfterMilliseconds (fn, delay = 500) {
            let timeoutId;
            return function(...args) {
                // versuche alten Timer löschen
                if (timeoutId) {
                   // console.log("Timeout cleared");
                    clearTimeout(timeoutId);
                }
                // neuen Timer setzen
                timeoutId = setTimeout( function () {fn.apply(null, args)}, delay);
            };
        }
        
        
        // Bei Eingaben in der Form 
        // =========================
        // Wenn Eingaben im Formular erfolgen, dann soll je nach Feld
        // eine Funktion, die die Eingabe überprüft, verzögert ausgeführt werden
        // oninput: wird aufgerufen wenn eine Änderung erfolgt
        // onchange: wird aufgerufen wenn das Element den Focus verliert
        form.addEventListener('input', executeFunctionAfterMilliseconds(function (e) {
            switch (e.target.id) {
                case 'username':
                    checkUsername();
                    break;
                case 'email':
                    checkEmail();
                    break;
                case 'password':
                    checkPassword();
                    break;
                case 'confirm-password':
                    checkConfirmPassword();
                    break;
                }
            }, 1500));
            </script>


    </body>
</html>